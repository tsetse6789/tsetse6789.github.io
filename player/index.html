<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>YouTube Player</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#5D5CDE'
                    }
                }
            }
        }
    </script>
    <style>
        .fade-in {
            animation: fadeIn 0.3s ease-in;
        }
        
        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
    </style>
</head>
<body class="bg-white dark:bg-gray-900 text-gray-900 dark:text-white min-h-screen">
    <div class="container mx-auto px-4 py-6 max-w-6xl">
        <!-- Header -->
        <div class="text-center mb-8">
            <h1 class="text-3xl font-bold text-primary mb-2">No Ads YouTube Player</h1>
            <p class="text-gray-600 dark:text-gray-400">Search videos on YouTube or paste a video URL to play</p>
        </div>

        <!-- URL Input Section -->
        <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 mb-6 shadow-sm">
            <label for="urlInput" class="block text-sm font-medium mb-3">
                Paste YouTube URL to play video:
            </label>
            <div class="flex flex-col sm:flex-row gap-3">
                <input 
                    type="text" 
                    id="urlInput" 
                    placeholder="https://youtu.be/dQw4w9WgXcQ or https://www.youtube.com/watch?v=dQw4w9WgXcQ"
                    class="flex-1 px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white placeholder-gray-500 dark:placeholder-gray-400"
                >
                <button 
                    onclick="loadVideo()" 
                    class="px-6 py-3 bg-primary text-white rounded-lg hover:bg-opacity-90 transition-colors font-medium"
                >
                    Play Video
                </button>
            </div>
            <div id="urlError" class="text-red-500 text-sm mt-2 hidden"></div>
        </div>

        <!-- Video Player Section -->
        <div id="videoContainer" class="hidden fade-in mb-6">
            <div class="bg-gray-50 dark:bg-gray-800 rounded-lg p-4 shadow-sm">
                <h3 class="text-lg font-semibold mb-4">Now Playing:</h3>
                <div class="relative w-full" style="padding-bottom: 56.25%; /* 16:9 aspect ratio */">
                    <iframe 
                        id="videoPlayer"
                        class="absolute top-0 left-0 w-full h-full rounded-lg"
                        src="" 
                        title="YouTube video player" 
                        frameborder="0" 
                        allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture; web-share" 
                        referrerpolicy="strict-origin-when-cross-origin" 
                        allowfullscreen>
                    </iframe>
                </div>
                <button 
                    onclick="clearVideo()" 
                    class="mt-4 px-4 py-2 bg-gray-600 text-white rounded-lg hover:bg-gray-700 transition-colors"
                >
                    Clear Video
                </button>
            </div>
        </div>

        <!-- API Key Setup Section -->
        <div id="apiKeySection" class="bg-yellow-50 dark:bg-yellow-900/20 rounded-lg p-6 mb-6 border border-yellow-200 dark:border-yellow-800">
            <h3 class="text-lg font-semibold mb-3 text-yellow-800 dark:text-yellow-200">YouTube API Setup Required</h3>
            <p class="text-sm text-yellow-700 dark:text-yellow-300 mb-4">
                To search videos directly in the app, you need a YouTube Data API key. This is free and takes 2 minutes to set up.
            </p>
            <div class="mb-4">
                <label for="apiKeyInput" class="block text-sm font-medium mb-2 text-yellow-800 dark:text-yellow-200">
                    Enter your YouTube Data API Key:
                </label>
                <div class="flex flex-col sm:flex-row gap-3">
                    <input 
                        type="text" 
                        id="apiKeyInput" 
                        placeholder="AIzaSyC..."
                        class="flex-1 px-4 py-2 text-base border border-yellow-300 dark:border-yellow-600 rounded-lg focus:ring-2 focus:ring-yellow-500 focus:border-transparent bg-white dark:bg-yellow-900/50 text-gray-900 dark:text-yellow-100"
                    >
                    <button 
                        onclick="saveApiKey()" 
                        class="px-6 py-2 bg-yellow-600 text-white rounded-lg hover:bg-yellow-700 transition-colors font-medium"
                    >
                        Save API Key
                    </button>
                </div>
            </div>
            <div class="text-xs text-yellow-600 dark:text-yellow-400">
                <p class="mb-2"><strong>How to get API Key:</strong></p>
                <ol class="list-decimal list-inside space-y-1 ml-2">
                    <li>Go to <a href="https://console.developers.google.com" target="_blank" class="underline">Google Cloud Console</a></li>
                    <li>Create a new project or select existing one</li>
                    <li>Enable "YouTube Data API v3"</li>
                    <li>Go to "Credentials" → "Create Credentials" → "API Key"</li>
                    <li>Copy the API key and paste it above</li>
                </ol>
            </div>
        </div>

        <!-- YouTube Search Section -->
        <div id="searchSection" class="bg-gray-50 dark:bg-gray-800 rounded-lg p-6 shadow-sm hidden">
            <h3 class="text-lg font-semibold mb-4">Search Videos on YouTube:</h3>
            <div class="flex flex-col sm:flex-row gap-3 mb-6">
                <input 
                    type="text" 
                    id="searchInput" 
                    placeholder="Search for videos..."
                    class="flex-1 px-4 py-3 text-base border border-gray-300 dark:border-gray-600 rounded-lg focus:ring-2 focus:ring-primary focus:border-transparent bg-white dark:bg-gray-700 text-gray-900 dark:text-white"
                >
                <button 
                    onclick="searchVideos()" 
                    id="searchButton"
                    class="px-6 py-3 bg-red-600 text-white rounded-lg hover:bg-red-700 transition-colors font-medium"
                >
                    <svg class="w-5 h-5 inline mr-2" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z"></path>
                    </svg>
                    Search
                </button>
            </div>
            
            <!-- Loading State -->
            <div id="loadingState" class="text-center py-8 hidden">
                <div class="animate-spin inline-block w-8 h-8 border-4 border-current border-t-transparent text-primary rounded-full" role="status"></div>
                <p class="mt-2 text-gray-600 dark:text-gray-400">Searching videos...</p>
            </div>
            
            <!-- Search Results -->
            <div id="searchResults" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-4"></div>
            
            <!-- No Results -->
            <div id="noResults" class="text-center py-8 hidden">
                <p class="text-gray-600 dark:text-gray-400">No videos found. Try a different search term.</p>
            </div>
        </div>
    </div>

    <script>
        // Dark mode support
        if (window.matchMedia && window.matchMedia('(prefers-color-scheme: dark)').matches) {
            document.documentElement.classList.add('dark');
        }
        window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', event => {
            if (event.matches) {
                document.documentElement.classList.add('dark');
            } else {
                document.documentElement.classList.remove('dark');
            }
        });

        // Extract video ID from various YouTube URL formats
        function extractVideoId(url) {
            // Handle different YouTube URL formats
            const patterns = [
                /(?:youtube\.com\/watch\?v=|youtu\.be\/|youtube\.com\/embed\/)([^&\n?#]+)/,
                /^([a-zA-Z0-9_-]{11})$/ // Direct video ID
            ];
            
            for (const pattern of patterns) {
                const match = url.match(pattern);
                if (match) {
                    return match[1];
                }
            }
            return null;
        }

        // Load and play video
        function loadVideo() {
            const urlInput = document.getElementById('urlInput');
            const videoContainer = document.getElementById('videoContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            const urlError = document.getElementById('urlError');
            
            const url = urlInput.value.trim();
            
            if (!url) {
                showError('Please enter a YouTube URL');
                return;
            }
            
            const videoId = extractVideoId(url);
            
            if (!videoId) {
                showError('Invalid YouTube URL. Please use a valid YouTube video URL.');
                return;
            }
            
            // Hide error and show video
            hideError();
            const embedUrl = `https://www.youtube.com/embed/${videoId}`;
            videoPlayer.src = embedUrl;
            videoContainer.classList.remove('hidden');
            
            // Scroll to video
            videoContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
            
            console.log('Loading video with ID:', videoId);
        }

        // Clear video player
        function clearVideo() {
            const videoContainer = document.getElementById('videoContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            const urlInput = document.getElementById('urlInput');
            
            videoPlayer.src = '';
            videoContainer.classList.add('hidden');
            urlInput.value = '';
            hideError();
        }

        // Show error message
        function showError(message) {
            const urlError = document.getElementById('urlError');
            urlError.textContent = message;
            urlError.classList.remove('hidden');
        }

        // Hide error message
        function hideError() {
            const urlError = document.getElementById('urlError');
            urlError.classList.add('hidden');
        }

        // Handle Enter key in input field
        document.getElementById('urlInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                loadVideo();
            }
        });

        // Auto-load video if URL is pasted
        document.getElementById('urlInput').addEventListener('paste', function(event) {
            setTimeout(() => {
                const url = event.target.value.trim();
                if (url && extractVideoId(url)) {
                    loadVideo();
                }
            }, 100);
        });

        // YouTube API functionality
        let apiKey = 'AIzaSyCQExuj8PVT14tgxr9jUB7qGsG364P_u48';

        // Auto-initialize with provided API key
        window.addEventListener('DOMContentLoaded', function() {
            // Set the API key in the input field and show search section
            document.getElementById('apiKeyInput').value = apiKey;
            showSearchSection();
        });

        // Save API key
        function saveApiKey() {
            const input = document.getElementById('apiKeyInput');
            const key = input.value.trim();
            
            if (!key) {
                alert('Please enter a valid API key');
                return;
            }
            
            apiKey = key;
            showSearchSection();
        }

        // Show search section and hide API setup
        function showSearchSection() {
            document.getElementById('apiKeySection').classList.add('hidden');
            document.getElementById('searchSection').classList.remove('hidden');
        }

        // Search videos using YouTube API
        async function searchVideos() {
            const searchInput = document.getElementById('searchInput');
            const query = searchInput.value.trim();
            
            if (!query) {
                alert('Please enter a search term');
                return;
            }
            
            if (!apiKey) {
                alert('Please set up your API key first');
                return;
            }
            
            // Show loading state
            showLoading();
            
            try {
                const url = `https://www.googleapis.com/youtube/v3/search?part=snippet&maxResults=12&q=${encodeURIComponent(query)}&type=video&key=${apiKey}`;
                console.log('API Request URL:', url);
                
                const response = await fetch(url);
                console.log('Response status:', response.status);
                
                if (!response.ok) {
                    const errorText = await response.text();
                    console.error('API Error Response:', errorText);
                    
                    let errorMessage = `API Error (${response.status})`;
                    
                    try {
                        const errorData = JSON.parse(errorText);
                        if (errorData.error && errorData.error.message) {
                            errorMessage += `: ${errorData.error.message}`;
                        }
                        
                        // Common error messages
                        if (response.status === 403) {
                            if (errorText.includes('disabled')) {
                                errorMessage = 'YouTube Data API v3 is not enabled for this project. Please enable it in Google Cloud Console.';
                            } else if (errorText.includes('referer')) {
                                errorMessage = 'API key has referer restrictions. Please remove restrictions or add your domain.';
                            } else {
                                errorMessage = 'API key access denied. Check if YouTube Data API v3 is enabled and key is valid.';
                            }
                        } else if (response.status === 400) {
                            errorMessage = 'Invalid API request. Please check your API key format.';
                        } else if (response.status === 429) {
                            errorMessage = 'API quota exceeded. Please try again later or check your quota limits.';
                        }
                    } catch (e) {
                        // If we can't parse the error response, just show the status
                    }
                    
                    throw new Error(errorMessage);
                }
                
                const data = await response.json();
                console.log('API Response:', data);
                displaySearchResults(data.items);
                
            } catch (error) {
                console.error('Search error:', error);
                hideLoading();
                
                // Show detailed error message
                const errorDiv = document.createElement('div');
                errorDiv.className = 'bg-red-50 dark:bg-red-900/20 border border-red-200 dark:border-red-800 rounded-lg p-4 mt-4';
                errorDiv.innerHTML = `
                    <h4 class="font-semibold text-red-800 dark:text-red-200 mb-2">Search Failed</h4>
                    <p class="text-sm text-red-700 dark:text-red-300 mb-3">${error.message}</p>
                    <div class="text-xs text-red-600 dark:text-red-400">
                        <p class="mb-1"><strong>Common fixes:</strong></p>
                        <ul class="list-disc list-inside space-y-1 ml-2">
                            <li>Make sure YouTube Data API v3 is enabled in Google Cloud Console</li>
                            <li>Check if your API key has any restrictions (remove them for testing)</li>
                            <li>Verify the API key is copied correctly</li>
                            <li>Check if you've exceeded your daily quota</li>
                        </ul>
                    </div>
                `;
                
                // Insert error message after search section
                const searchSection = document.getElementById('searchSection');
                const existingError = document.querySelector('.search-error');
                if (existingError) {
                    existingError.remove();
                }
                errorDiv.classList.add('search-error');
                searchSection.appendChild(errorDiv);
            }
        }

        // Display search results
        function displaySearchResults(videos) {
            hideLoading();
            const resultsContainer = document.getElementById('searchResults');
            const noResultsDiv = document.getElementById('noResults');
            
            if (!videos || videos.length === 0) {
                resultsContainer.innerHTML = '';
                noResultsDiv.classList.remove('hidden');
                return;
            }
            
            noResultsDiv.classList.add('hidden');
            
            resultsContainer.innerHTML = videos.map(video => `
                <div class="bg-white dark:bg-gray-700 rounded-lg shadow-md overflow-hidden cursor-pointer hover:shadow-lg transition-shadow" onclick="playVideoFromSearch('${video.id.videoId}')">
                    <div class="relative">
                        <img src="${video.snippet.thumbnails.medium.url}" alt="${video.snippet.title}" class="w-full h-48 object-cover">
                        <div class="absolute bottom-2 right-2 bg-black bg-opacity-75 text-white text-xs px-2 py-1 rounded">
                            <svg class="w-3 h-3 inline mr-1" fill="currentColor" viewBox="0 0 20 20">
                                <path d="M6.3 2.841A1.5 1.5 0 004 4.11V15.89a1.5 1.5 0 002.3 1.269l9.344-5.89a1.5 1.5 0 000-2.538L6.3 2.84z"/>
                            </svg>
                            Play
                        </div>
                    </div>
                    <div class="p-4">
                        <h4 class="font-semibold text-sm line-clamp-2 mb-2" title="${video.snippet.title}">
                            ${video.snippet.title}
                        </h4>
                        <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">
                            ${video.snippet.channelTitle}
                        </p>
                        <p class="text-xs text-gray-500 dark:text-gray-500">
                            ${formatDate(video.snippet.publishedAt)}
                        </p>
                    </div>
                </div>
            `).join('');
        }

        // Play video from search results
        function playVideoFromSearch(videoId) {
            const videoContainer = document.getElementById('videoContainer');
            const videoPlayer = document.getElementById('videoPlayer');
            const urlInput = document.getElementById('urlInput');
            
            const embedUrl = `https://www.youtube.com/embed/${videoId}`;
            videoPlayer.src = embedUrl;
            videoContainer.classList.remove('hidden');
            
            // Update URL input with the video URL
            urlInput.value = `https://youtu.be/${videoId}`;
            
            // Scroll to video
            videoContainer.scrollIntoView({ behavior: 'smooth', block: 'start' });
        }

        // Show loading state
        function showLoading() {
            document.getElementById('loadingState').classList.remove('hidden');
            document.getElementById('searchResults').innerHTML = '';
            document.getElementById('noResults').classList.add('hidden');
        }

        // Hide loading state
        function hideLoading() {
            document.getElementById('loadingState').classList.add('hidden');
        }

        // Format date
        function formatDate(dateString) {
            const date = new Date(dateString);
            const now = new Date();
            const diffTime = Math.abs(now - date);
            const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));
            
            if (diffDays === 0) return 'Today';
            if (diffDays === 1) return 'Yesterday';
            if (diffDays < 30) return `${diffDays} days ago`;
            if (diffDays < 365) return `${Math.floor(diffDays / 30)} months ago`;
            return `${Math.floor(diffDays / 365)} years ago`;
        }

        // Handle Enter key in search input
        document.getElementById('searchInput').addEventListener('keypress', function(event) {
            if (event.key === 'Enter') {
                searchVideos();
            }
        });
    </script>
</body>
</html>
